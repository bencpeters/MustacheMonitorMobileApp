/*! JsRender v1.0pre: http://github.com/BorisMoore/jsrender *//*
* Optimized version of jQuery Templates, for rendering to string.
* Does not require jQuery, or HTML DOM
* Integrates with JsViews (http://github.com/BorisMoore/jsviews)
* Copyright 2012, Boris Moore
* Released under the MIT License.
*/// informal pre beta commit counter: 21
(function(e,t,n){function O(e){this.name="JsRender Error",this.message=e||"JsRender error"}function M(e,t,n){if(!A.rTag||arguments.length)a=e?"\\"+e.charAt(0):a,f=e?"\\"+e.charAt(1):f,l=t?"\\"+t.charAt(0):l,c=t?"\\"+t.charAt(0):c,n=n?"\\"+n:h,A.rTag=s="(\\w*"+n+")?(?:(?:(\\w+(?=[\\/\\s"+l+"]))|(?:(\\w+)?(:)|(>)|(\\*)))"+"\\s*((?:[^"+l+"]|"+l+"(?!"+c+"))*?)",s=new RegExp(a+f+s+"(\\/)?|(?:\\/(\\w+)))"+l+c,"g"),o=new RegExp("<.*>|([^\\\\]|^)[{}]|"+a+f+".*"+l+c);return[a,f,l,c,h]}function _(e){var t=this,r=t.tmpl.helpers||{};return e=(t.dynCtx&&t.dynCtx[e]!==n?t.dynCtx:t.ctx[e]!==n?t.ctx:r[e]!==n?r:q[e]!==n?q:{})[e],typeof e!="function"?e:function(){return e.apply(t,arguments)}}function D(e,t,r,i){var s=!r.markup&&r||n,o=t.tmpl.converters;return o=o&&o[e]||R[e],o?o.call(t,i,s):(W("Unknown converter: {{"+e+":"),i)}function P(e,t,r,i,s){var o,u=!r.markup&&r,a=u?u.view.tmpl:r,f=a.tags,l=a.templates,c=s.props=s.props||{},h=c.tmpl,p=arguments.length>5?k.call(arguments,5):[],d=f&&f[e]||I[e];return d?(i=i&&a.tmpls[i-1],h=h||i||d.template||n,s.view=t,h=s.tmpl=""+h===h?l&&l[h]||F[h]||F(h):h,s.attr=r.attr=r.attr||d.attr,s.tagName=e,s.renderContent=U,u&&(u.tagCtx={args:p,props:c,path:s.path,tag:d}),d.render&&(o=d.render.apply(s,p)),o||(o==n?h?s.renderContent(p[0],n,t):"":o.toString())):(W("Unknown tag: {{"+e+"}}"),"")}function H(e,t,r,i,s,o,u,a){var f,l={data:i,tmpl:s,views:a?[]:{},parent:r,ctx:e,path:t,_useKey:a?0:1,_onRender:u,_hlp:_,renderLink:function(t){var n=this.tmpl.tmpls[t];return n.render(i,e,this)}};return r&&(f=r.views,r._useKey?(f[l.key="_"+r._useKey++]=l,l.index=r.index):f.splice(l.key=l.index=o!==n?o:f.length,0,l)),l}function B(e,t,r,i,s){var o,u;if(r&&typeof r=="object"&&!r.nodeType){for(o in r)t(o,r[o]);return e}i===n&&(i=r,r=n);if(u=p.onBeforeStoreItem)s=u(t,r,i,s)||s;return r?""+r===r&&(i===null?delete t[r]:t[r]=s?i=s(i,r):i):i=s?s(i):i,(u=p.onStoreItem)&&u(t,r,i,s),i}function j(e,t){return e=typeof e=="function"?{render:e}:e,e.name=t,e.is="tag",e}function F(e,t){return B(this,F,e,t,Q)}function I(e,t){return B(this,I,e,t,j)}function q(e,t){return B(this,q,e,t)}function R(e,t){return B(this,R,e,t)}function U(e,t,r,s,o,a,f){var l,c,h,p,m,g,y,b,w,E,S,x,T=this,N="";s===v&&(w=v,s=0);if(T.tagName){y=T.tmpl;if(t||T.ctx)E={},T.ctx&&u(E,T.ctx),t&&u(E,t);t=E,b=T.props,b&&b.link===d&&(t=t||{},t.link=d),r=r||T.view,a=a||T.path,s=s||T.key,f=r&&r._onRender}else y=T.jquery&&(T[0]||W('Unknown template: "'+T.selector+'"'))||T,f=f||r&&r._onRender;if(y){r?(g=r.ctx,S=r.dynCtx,e===r&&(e=r.data,o=v)):g=q,x=t&&t!==g;if(S||x)g=u({},g),x&&u(g,t),S&&u(g,S);t=g,y.fn||(y=F[y]||F(y));if(y){f=t.link!==d&&f;if(i.isArray(e)&&!o){p=w?r:s!==n&&r||H(t,a,r,e,y,s,f,v);for(l=0,c=e.length;l<c;l++)h=e[l],m=y.fn(h,H(t,a,p,h,y,(s||0)+l,f),A),N+=f?f(m,y,b):m}else p=w?r:H(t,a,r,e,y,s,f),p._onRender=f,N+=y.fn(e,p,A,z);return f?f(N,y,b,p.key,a):N}}return W("No template found"),""}function z(e){return e}function W(e){if(A.debugMode)throw new A.Error(e)}function X(e){W("Syntax error\n"+e)}function V(e,t,n){function c(t){t-=u,t&&f.push(e.substr(u,t).replace(y,"\\n"))}function h(t){t&&X('Unmatched or missing tag: "{{/'+t+'}}" in template:\n'+e)}function p(t,s,o,p,d,m,g,y,w,S,x){m&&(d=":",p="html");var T,N="",C="",k=!w&&!d&&!n;o=o||d,c(x),u=x+t.length,g?i&&f.push(["*",y.replace(b,"$1")]):o?(o==="else"?(l[5]=e.substring(l[5],x),l=a.pop(),f=l[3],k=v):s&&(a.push(l),l=["!",,,[],,x],f.push(l),f=l[3]),y=y?J(y,n,s).replace(E,function(e,t,n){return t?C+=n+",":N+=n+",",""}):"",N=N.slice(0,-1),y=y.slice(0,-1),r=[o,p||"",y,k&&[],"{"+(N?"props:{"+N+"},":"")+"data: data"+(C?",ctx:{"+C.slice(0,-1)+"}":"")+"}"],f.push(r),k?(a.push(l),l=r,l[5]=u):s&&(l[5]=e.substring(l[5],u),l=a.pop())):S&&(T=l[0],h(S!==T&&(S!=="if"||T!=="else")&&T),l[5]=e.substring(l[5],x),T==="!"&&(l[5]=e.substring(l[5],u),l=a.pop()),l=a.pop()),h(!l&&S),f=l[3]}var r,i=t&&t.allowCode,o=[],u=0,a=[],f=o,l=[,,,o];return e=e.replace(w,"\\$1"),h(a[0]&&a[0][3].pop()[0]),e.replace(s,p),c(e.length),$(o,t)}function $(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,m,g,y,b,w,E=t?{allowCode:g=t.allowCode,debug:t.debug}:{},S=t&&t.tmpls;i=e.length,s=i?"":'"";';for(r=0;r<i;r++)n=e[r],""+n===n?s+='"'+n+'"+':(c=n[0],c==="*"?s=s.slice(0,r?-1:-3)+";"+n[1]+(r+1<i?"ret+=":""):(h=n[1],p=n[2],y=n[3],d=n[4],markup=n[5],c.slice(-1)==="!"?(m=G(markup,E,t,S.length),$(y,m),(b=/\s+[\w-]*\s*\=\s*\\['"]$/.exec(e[r-1]))&&W("'{{!' in attribute:\n..."+e[r-1]+"{{!...\nUse data-link"),s+="view.renderLink("+S.length+")+",m.bound=v,m.fn.attr=b||"leaf",S.push(m)):(y&&(m=G(markup,E,t,S.length),$(y,m),S.push(m)),l=l||d.indexOf("view")>-1,s+=(c===":"?h==="html"?(u=v,"h("+p):h?(f=v,'c("'+h+'",view,this,'+p):(a=v,"((v="+p+')!=u?v:""'):(o=v,'t("'+c+'",view,this,'+(y?S.length:'""')+","+d+(p?",":"")+p))+")+")));s=N+(a?"v,":"")+(o?"t=j._tag,":"")+(f?"c=j._convert,":"")+(u?"h=j.converters.html,":"")+"ret; try{\n\n"+(E.debug?"debugger;":"")+(g?"ret=":"return ")+s.slice(0,-1)+";\n\n"+(g?"return ret;":"")+"}catch(e){return j._err(e);}";try{s=new Function("data, view, j, b, u",s)}catch(x){X("Compiled template code:\n\n"+s,x)}return t&&(t.fn=s),s}function J(e,t,n){function a(a,f,l,c,h,p,g,y,b,w,E,S,x,T,N,C){function L(e,t,n,r,i,s,o){if(t){var u,a=(n?'view._hlp("'+n+'")':r?"view":"data")+(o?(i?"."+i:n?"":r?"":"."+t)+(s||""):(o=n?"":r?i||"":t,""));return u=o?"."+o:"",k||(a+=u),a=a.slice(0,9)==="view.data"?a.slice(5):a,k&&(a="b("+a+',"'+o+'")'+u),a}return e}h=h||"",l=l||f||E,c=c||y,b=b||N||"",h=h||"";var k=(t||n)&&b!=="(";if(!p)return u?(u=!S,u?a:'"'):o?(o=!x,o?a:'"'):(l?(s++,l):"")+(C?s?"":r?(r=d,"\b"):",":g?(s&&X(e),r=v,"\b"+c+":"):c?c.replace(m,L)+(b?(i[++s]=v,b):h):h?h:T?(i[s--]=d,T)+(b?(i[++s]=v,b):""):w?(i[s]||X(e),","):f?"":(u=S,o=x,'"'));X(e)}var r,i={},s=0,o=d,u=d;return e=(e+" ").replace(g,a),e}function K(e,t,n){var r,i;if(e)for(r in e)i=e[r],i.is||(e[r]=t(i,r,n))}function Q(e,r,i,s){function l(e){if(""+e===e||e.nodeType>0){try{f=e.nodeType>0?e:!o.test(e)&&t&&t(e)[0]}catch(n){}return f&&(e=F[f.getAttribute(T)],e||(r=r||"_"+S++,f.setAttribute(T,r),e=Q(f.innerHTML,r,i,s),F[r]=e)),e}}var a,f;e=e||"",a=l(e),s=s||(e.markup?e:{}),s.name=r,s.is="tmpl",!a&&e.markup&&(a=l(e.markup))&&a.fn&&(a.debug!==e.debug||a.allowCode!==e.allowCode)&&(a=a.markup);if(a!==n)return r&&!i&&(L[r]=function(){return e.render.apply(e,arguments)}),a.fn||e.fn?a.fn&&(r&&r!==a.name?e=u(u({},a),s):e=a):(e=G(a,s,i,0),V(a,e)),K(s.templates,Q,e),K(s.tags,j),e}function G(e,t,n,r){function i(e){n[e]&&(s[e]=u(u({},n[e]),t[e]))}t=t||{};var s={markup:e,tmpls:[],links:[],render:U};return n&&(n.templates&&(s.templates=u(u({},n.templates),t.templates)),s.parent=n,s.name=n.name+"["+r+"]",s.key=r),u(s,t),n&&(i("templates"),i("tags"),i("helpers"),i("converters")),s}function Y(e){return x[e]||(x[e]="&#"+e.charCodeAt(0)+";")}if(t&&t.views||e.jsviews)return;var r="v1.0pre",i,s,o,u,a="{",f="{",l="}",c="}",h="!",p={},d=!1,v=!0,m=/^(?:null|true|false|\d[\d.]*|([\w$]+|~([\w$]+)|#(view|([\w$]+))?)([\w$.]*?)(?:[.[]([\w$]+)\]?)?|(['"]).*\8)$/g,g=/(\()(?=|\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*([)\]])([([]?))|(\s+)/g,y=/\r?\n/g,b=/\\(['"])/g,w=/\\?(['"])/g,E=/\x08(~)?([^\x08]+)\x08/g,S=0,x={"&":"&amp;","<":"&lt;",">":"&gt;"},T="data-jsv-tmpl",N="var j=j||"+(t?"jQuery.":"js")+"views,",C=/[\x00"&'<>]/g,k=Array.prototype.slice,L={},A={jsviews:r,sub:p,debugMode:v,render:L,templates:F,tags:I,helpers:q,converters:R,delimiters:M,View:H,_convert:D,_err:function(e){return A.debugMode?"Error: "+(e.message||e)+". ":""},_tmplFn:V,_tag:P,error:W,Error:O};(O.prototype=new Error).constructor=O,t?(i=t,i.templates=F,i.render=L,i.views=A,i.fn.render=U):(i=e.jsviews=A,i.extend=function(e,t){var n;e=e||{};for(n in t)e[n]=t[n];return e},i.isArray=Array&&Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}),u=i.extend,I({"if":function(){var e=this,t=e.view;return t.onElse=function(e,r){var i=0,s=r.length;while(s&&!r[i++])if(i===s)return"";return t.onElse=n,e.path="",e.renderContent(t)},t.onElse(this,arguments)},"else":function(){var e=this.view;return e.onElse?e.onElse(this,arguments):""},"for":function(){var e,t=this,n="",r=arguments,i=r.length;i===0&&(i=1);for(e=0;e<i;e++)n+=t.renderContent(r[e]);return n},"*":function(e){return e}}),R({html:function(e){return e!=n?String(e).replace(C,Y):""}}),M()})(this,this.jQuery);